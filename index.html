<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game: Divisibilitat Extrema</title>
    <style>
        :root { --primary: #4f46e5; --success: #22c55e; --error: #ef4444; --bg: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        
        /* Stats Bar */
        .stats-bar { display: flex; justify-content: space-between; align-items: center; background: #1e293b; color: white; padding: 15px 25px; border-radius: 12px; margin-bottom: 20px; }
        .lives { color: #fb7185; font-size: 1.4rem; letter-spacing: 3px; }
        .score { font-weight: bold; font-size: 1.2rem; }

        /* Level Tabs */
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 10px; border: none; background: #e2e8f0; cursor: pointer; border-radius: 8px 8px 0 0; font-weight: bold; transition: 0.3s; }
        .tab.active { background: var(--primary); color: white; }

        /* Table */
        table { width: 100%; border-collapse: separate; border-spacing: 5px; margin-bottom: 20px; }
        th { background: #f1f5f9; padding: 10px; border-radius: 6px; font-size: 0.85rem; position: relative; }
        td { background: #fff; border: 1px solid #e2e8f0; border-radius: 6px; text-align: center; height: 50px; }
        .num-cell { font-weight: bold; font-size: 1.2rem; background: #f8fafc; }

        /* Cells and Feedback */
        .check-cell { cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 1.2rem; color: transparent; }
        .check-cell:hover { background: #f1f5f9; }
        .check-cell.correct { background: #dcfce7 !important; color: #166534 !important; border-color: var(--success); }
        .check-cell.wrong { background: #fee2e2 !important; color: #991b1b !important; border-color: var(--error); animation: shake 0.3s; }

        /* Help and Explanation */
        .help-icon { font-size: 0.7rem; background: #cbd5e1; color: white; border-radius: 50%; width: 15px; height: 15px; display: inline-flex; align-items: center; justify-content: center; margin-left: 4px; cursor: help; }
        .explanation-box { background: #fffbeb; border: 1px solid #fde68a; padding: 15px; border-radius: 10px; margin-top: 20px; display: none; text-align: left; }
        .rule-hint { font-size: 0.8rem; color: #64748b; margin-top: 4px; font-weight: normal; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="stats-bar">
        <div class="score">Punts: <span id="scoreVal">0</span></div>
        <div class="lives" id="livesDisplay">❤️❤️❤️</div>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="changeLevel('mitja')">Mitjà (2-10)</button>
        <button class="tab" onclick="changeLevel('avancat')">Avançat (6, 12)</button>
        <button class="tab" onclick="changeLevel('pro')">Pro (7, 11)</button>
    </div>

    <div id="explanation" class="explanation-box"></div>

    <table id="gameTable">
        <thead id="tableHead"></thead>
        <tbody id="tableBody"></tbody>
    </table>

    <p style="color: #64748b; font-size: 0.8rem;"><i>* Clica a les caselles. Verd = Sumes punts. Vermell = Perds una vida i reps una explicació.</i></p>
</div>

<script>
    const rules = {
        2: "Acaba en xifra parell (0, 2, 4, 6, 8).",
        3: "La suma de les seves xifres és múltiple de 3.",
        4: "Les últimes dues xifres són 00 o múltiple de 4.",
        5: "Acaba en 0 o en 5.",
        6: "És divisible per 2 i per 3 alhora.",
        7: "Resta el doble de l'última xifra a la resta del número i mira si és múltiple de 7.",
        8: "Les últimes tres xifres són múltiples de 8.",
        9: "La suma de les seves xifres és múltiple de 9.",
        10: "Acaba en 0.",
        11: "La resta entre la suma de xifres en posició parell i imparell és 0 o múltiple d'11.",
        12: "És divisible per 3 i per 4 alhora."
    };

    const levels = {
        mitja: [2, 3, 5, 10],
        avancat: [3, 4, 6, 12],
        pro: [7, 8, 9, 11]
    };

    let state = { lives: 3, score: 0, level: 'mitja', gameOver: false };

    function changeLevel(l) {
        state.level = l;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        resetGame();
    }

    function resetGame() {
        state.lives = 3;
        state.score = 0;
        state.gameOver = false;
        document.getElementById('explanation').style.display = 'none';
        updateStats();
        renderTable();
    }

    function updateStats() {
        document.getElementById('scoreVal').innerText = state.score;
        document.getElementById('livesDisplay').innerText = "❤️".repeat(state.lives);
        if (state.lives <= 0) {
            state.gameOver = true;
            alert("JOC ACABAT! Has aconseguit " + state.score + " punts. Torna-ho a intentar!");
            resetGame();
        }
    }

    function renderTable() {
        const divisors = levels[state.level];
        const head = document.getElementById('tableHead');
        const body = document.getElementById('tableBody');
        
        head.innerHTML = `<tr><th>Número</th>${divisors.map(d => `<th>${d}<div class="rule-hint">${rules[d]}</div></th>`).join('')}</tr>`;
        body.innerHTML = '';

        for (let i = 0; i < 6; i++) {
            let num = Math.floor(Math.random() * 2000) + 10;
            let row = document.createElement('tr');
            row.innerHTML = `<td class="num-cell">${num}</td>` + divisors.map(d => `
                <td class="check-cell" onclick="handleCheck(this, ${num}, ${d})">?</td>
            `).join('');
            body.appendChild(row);
        }
    }

    function handleCheck(el, num, div) {
        if (state.gameOver || el.classList.contains('correct') || el.classList.contains('wrong')) return;

        const isCorrect = (num % div === 0);
        const expBox = document.getElementById('explanation');

        if (isCorrect) {
            el.classList.add('correct');
            el.innerText = "✓";
            state.score += 10;
            expBox.style.display = 'none';
        } else {
            el.classList.add('wrong');
            el.innerText = "✗";
            state.lives--;
            state.score = Math.max(0, state.score - 5);
            
            // Explicació detallada de l'error
            expBox.style.display = 'block';
            expBox.innerHTML = `<strong>Error!</strong> El número <b>${num}</b> no és divisible per <b>${div}</b>.<br>
                                <small>Recordatori: ${rules[div]}</small><br>
                                <em>${num} ÷ ${div} = ${(num/div).toFixed(2)} (no és exacte).</em>`;
        }
        updateStats();
    }

    renderTable();
</script>
</body>
</html>
